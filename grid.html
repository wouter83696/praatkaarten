<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Praatkaarten</title>
<style>
  :root{
    --gap:18px;
    --radius:16px;
    --shadow:0 14px 50px rgba(0,0,0,.12);
    --shadowHover:0 18px 70px rgba(0,0,0,.16);
    --ink: rgba(30, 78, 118, 1);
    --ui: rgba(30, 78, 118, .62); /* fix9-blauw */
    --bar: rgba(11,18,32,.55);
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0}
  body{background:#fff;font-family:system-ui;-webkit-font-smoothing:antialiased}

  /* Onderbalk */
  .controlsBar{
    position:fixed;left:0;right:0;bottom:0;z-index:50;
    padding:12px 18px calc(12px + env(safe-area-inset-bottom));
    background:rgba(255,255,255,.86);
    backdrop-filter:blur(10px);
  }
  .controlsBar .inner{
    max-width:1600px;margin:0 auto;
    display:flex;gap:12px;align-items:center;justify-content:space-between;
  }
  .btn{
    appearance:none;border:0;background:transparent;
    border-radius:999px;padding:10px 10px;
    font-size:13px;cursor:pointer;color:rgba(11,18,32,.78);
  }
  .btn:hover{background:rgba(0,0,0,.04)}
  .btnGroup{display:flex;align-items:center;gap:0}
  .sep{width:1px;height:18px;background:rgba(0,0,0,.12);margin:0 8px}
  .help{color:rgba(11,18,32,.55);font-size:13px;white-space:normal}

  /* Grid */
  .grid{
    display:grid;gap:var(--gap);
    padding:18px 28px 120px;
    max-width:1600px;margin:auto;
    grid-template-columns:repeat(2,minmax(0,1fr));
  }
  @media (min-width: 720px){ .grid{grid-template-columns:repeat(3,minmax(0,1fr));} }
  @media (min-width: 980px){ .grid{grid-template-columns:repeat(4,minmax(0,1fr));} }
  @media (min-width: 1240px){ .grid{grid-template-columns:repeat(6,minmax(0,1fr));} }

  /* Mobiel landscape: verberg onderste balk als lightbox open is */
  @media (hover: none) and (orientation: landscape){
    body.lb-open .controlsBar{ display:none; }
    body.lb-open .grid{ padding-bottom: 18px; }
  }

  .card{
    border:0;background:transparent;padding:0;
    cursor:zoom-in;transition:transform .14s ease;
    position:relative;
  }
  .card:hover{transform:translateY(-2px)}
  .cardInner{
    width:100%;aspect-ratio:85/55;border-radius:var(--radius);
    box-shadow:var(--shadow);transition:box-shadow .14s ease;
    overflow:hidden;position:relative;background:#fff;
  }
  .card:hover .cardInner{box-shadow:var(--shadowHover)}

  .bg{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;display:block}
  .q{
    position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
    padding:14px 16px;text-align:center;color:var(--ink);
    font-weight:600;line-height:1.18;font-size:16px;
  }
  @media (max-width:520px){ .q{font-size:14px} }
  @media (min-width:980px){ .q{font-size:15px} }

  /* Hover-thema op kleine kaart: exact "groot-kaart" stijl (subtiel, fix9 timing) */
  .card::after{
    content: attr(data-theme-label);
    position:absolute;left:12px;bottom:10px;
    font-size:13px;line-height:1;
    color:rgba(30,78,118,.55);
    opacity:0;transition:opacity .18s ease;
    pointer-events:none;
  }
  .card:hover::after,
  .card:focus-visible::after{opacity:.9;}

  /* Lightbox */
  .lb{
    position:fixed;inset:0;width:100vw;height:100vh;
    display:none;align-items:center;justify-content:center;
    background:rgba(0,0,0,.28);backdrop-filter:blur(6px);
    touch-action:none;z-index:9999;
  }
  .lb.open{display:flex}
  .panel{
    position:relative;
    width:min(92vw, 920px);
    aspect-ratio:85/55;
    max-height:calc(92vh - env(safe-area-inset-top) - env(safe-area-inset-bottom));
    border-radius:22px;overflow:hidden;background:transparent;
    box-shadow:0 24px 90px rgba(0,0,0,.22);
  }
  .panel .cardInner{border-radius:22px;box-shadow:none;height:100%}
  .panel .q{font-size:30px;padding:26px 30px}
  @media (max-width:700px){ .panel .q{font-size:22px;padding:18px 18px} }

  /* Controls op de kaart */
  .chev, .close{
    position:absolute;border:0;background:transparent;
    cursor:pointer;user-select:none;
    opacity:0;transition:opacity .18s ease,color .18s ease;
    color:var(--ui);-webkit-tap-highlight-color:transparent;
  }
  .close{top:10px;right:10px;font-size:34px;font-weight:300;line-height:1;padding:10px 12px}
  .chev{bottom:10px;top:auto;transform:none;font-size:44px;line-height:1;padding:10px 12px}
  .chev.left{left:10px}
  .chev.right{right:10px}

  .lb.show-ui .chev,
  .lb.show-ui .close{opacity:.9}
  .lb.show-ui .chev:hover,
  .lb.show-ui .close:hover{opacity:1;color:rgba(30,78,118,.78)}
</style>
</head>
<body>

<div class="controlsBar">
  <div class="inner">
    <div class="btnGroup">
      <button class="btn" id="shuffle" type="button">Hussel</button>
      <span class="sep" aria-hidden="true"></span>
      <button class="btn" id="reset" type="button">Reset</button>
    </div>
    <div class="help">Klik om te vergroten • ESC sluit</div>
  </div>
</div>

<div class="grid" id="grid" aria-label="Kaarten"></div>

<div class="lb" id="lb" aria-hidden="true">
  <div class="panel" role="dialog" aria-modal="true">
    <button class="chev left" id="prev" aria-label="Vorige">‹</button>
    <button class="chev right" id="next" aria-label="Volgende">›</button>
    <button class="close" id="close" type="button" aria-label="Sluiten">×</button>
    <div id="lbCard"></div>
  </div>
</div>

<script>
(async () => {
  const grid = document.getElementById('grid');
  const lb = document.getElementById('lb');
  const lbCard = document.getElementById('lbCard');
  const closeBtn = document.getElementById('close');
  const prevBtn = document.getElementById('prev');
  const nextBtn = document.getElementById('next');
  const shuffleBtn = document.getElementById('shuffle');
  const resetBtn = document.getElementById('reset');
  if(!grid || !lb || !lbCard || !closeBtn || !prevBtn || !nextBtn || !shuffleBtn || !resetBtn) return;

  const resp = await fetch('questions.json', {cache:'no-store'});
  const q = await resp.json();

  const order = ['verkennen','verbinden','bewegen','duiden','verdiepen','vertragen'];
  const titleCase = s => s ? s.charAt(0).toUpperCase() + s.slice(1) : s;

  let items = [];
  for(const theme of order){
    const arr = Array.isArray(q[theme]) ? q[theme] : [];
    arr.forEach((text) => {
      items.push({
        theme,
        themeLabel: titleCase(theme),
        q: String(text),
        bg: `cards/${theme}.svg`
      });
    });
  }
  const initial = items.slice();
  let currentIndex = -1;

  const canHover = window.matchMedia && window.matchMedia('(hover:hover) and (pointer:fine)').matches;
  let uiTimer = null;
  function showUI(){
    lb.classList.add('show-ui');
    clearTimeout(uiTimer);
    const hideMs = canHover ? 650 : 850;
    uiTimer = setTimeout(() => lb.classList.remove('show-ui'), hideMs);
  }

  function escapeHtml(s){
    return String(s)
      .replaceAll('&','&amp;')
      .replaceAll('<','&lt;')
      .replaceAll('>','&gt;')
      .replaceAll('"','&quot;')
      .replaceAll("'",'&#39;');
  }

  function cardEl(item){
    const btn = document.createElement('button');
    btn.className = 'card';
    btn.type = 'button';
    btn.setAttribute('data-theme-label', item.themeLabel);
    btn.innerHTML = `
      <div class="cardInner">
        <img class="bg" src="${item.bg}" alt="">
        <div class="q">${escapeHtml(item.q)}</div>
      </div>
    `;
    return btn;
  }

  function render(list){
    grid.innerHTML = '';
    list.forEach((it, idx) => {
      const el = cardEl(it);
      el.addEventListener('click', () => openLbAt(idx));
      grid.appendChild(el);
    });
  }

  function renderLightbox(){
    const it = items[currentIndex];
    lbCard.innerHTML = `
      <div class="cardInner">
        <img class="bg" src="${it.bg}" alt="">
        <div class="q">${escapeHtml(it.q)}</div>
      </div>
    `;
  }

  function openLbAt(idx){
    currentIndex = ((idx % items.length) + items.length) % items.length;
    renderLightbox();
    lb.classList.add('open');
    document.body.classList.add('lb-open');
    document.body.style.overflow = 'hidden';
    showUI();
  }
  function closeLb(){
    lb.classList.remove('open');
    lb.classList.remove('show-ui');
    document.body.classList.remove('lb-open');
    document.body.style.overflow = '';
    lbCard.innerHTML = '';
    currentIndex = -1;
  }
  function go(delta){
    if(currentIndex < 0) return;
    currentIndex = (currentIndex + delta + items.length) % items.length;
    renderLightbox();
    showUI();
  }

  function shuffle(arr){
    const a = arr.slice();
    for(let i=a.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [a[i],a[j]]=[a[j],a[i]];
    }
    return a;
  }

  shuffleBtn.addEventListener('click', () => {
    items = shuffle(items);
    render(items);
    window.scrollTo({top:0, behavior:'smooth'});
  });
  resetBtn.addEventListener('click', () => {
    items = initial.slice();
    render(items);
    window.scrollTo({top:0, behavior:'smooth'});
  });

  closeBtn.addEventListener('click', (e) => { e.stopPropagation(); closeLb(); });
  prevBtn.addEventListener('click', (e) => { e.stopPropagation(); go(-1); });
  nextBtn.addEventListener('click', (e) => { e.stopPropagation(); go(1); });

  lb.addEventListener('click', (e) => { if(e.target === lb) closeLb(); });

  document.addEventListener('keydown', (e) => {
    if(!lb.classList.contains('open')) return;
    if(e.key === 'Escape') closeLb();
    if(e.key === 'ArrowLeft') go(-1);
    if(e.key === 'ArrowRight') go(1);
  });

  // Swipe overal (overlay + kaart), maar niet op knoppen
  let startX=0, startY=0, startT=0, down=false;
  lb.addEventListener('pointerdown', (e) => {
    if(!lb.classList.contains('open')) return;
    if(e.target.closest('.chev, .close')) return;
    down = true;
    startX = e.clientX; startY = e.clientY; startT = performance.now();
    lb.setPointerCapture?.(e.pointerId);
    showUI();
  });
  lb.addEventListener('pointerup', (e) => {
    if(!down) return;
    down = false;
    const dx = e.clientX - startX;
    const dy = e.clientY - startY;
    const dt = performance.now() - startT;
    const ax = Math.abs(dx), ay = Math.abs(dy);
    const fast = dt < 420;
    const thrX = fast ? 40 : 60;
    const thrY = fast ? 50 : 80;
    if(ay > ax && dy > thrY){ closeLb(); return; }
    if(ax > ay && ax > thrX){ go(dx > 0 ? -1 : 1); return; }
  });

  lb.addEventListener('mousemove', showUI);
  lb.addEventListener('pointermove', () => { if(!canHover) showUI(); });

  render(items);
})();
</script>
</body>
</html>
